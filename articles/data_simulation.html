<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="psborrow2">
<title>7. Data Simulation â€¢ psborrow2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="7. Data Simulation">
<meta property="og:description" content="psborrow2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">psborrow2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/psborrow2.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Genentech/psborrow2">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>7. Data Simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Genentech/psborrow2/blob/HEAD/vignettes/data_simulation.Rmd" class="external-link"><code>vignettes/data_simulation.Rmd</code></a></small>
      <div class="d-none name"><code>data_simulation.Rmd</code></div>
    </div>

    
    
<p>This vignette will show the internal functions for generating data
that can be used in simulation studies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Genentech/psborrow2" class="external-link">psborrow2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="generating-baseline-data">Generating Baseline Data<a class="anchor" aria-label="anchor" href="#generating-baseline-data"></a>
</h2>
<p>First we define how to generate baseline data for our study. In its
simplest form we only need to define how many patients are in the arms:
treated internal, control internal, control external.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_baseline_object.html">create_baseline_object</a></span><span class="op">(</span></span>
<span>  n_trt_int <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_ctrl_int <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  n_ctrl_ext <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This object defines how the data will be created. To actually
generate a sample, use <code><a href="../reference/generate.html">generate()</a></code> to produce a
<code>data.frame</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="va">simple_baseline</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulated Baseline Data</span></span>
<span><span class="co">#&gt;   patid ext trt</span></span>
<span><span class="co">#&gt; 1     1   0   1</span></span>
<span><span class="co">#&gt; 2     2   0   1</span></span>
<span><span class="co">#&gt; 3     3   0   1</span></span>
<span><span class="co">#&gt; 4     4   0   1</span></span>
<span><span class="co">#&gt; 5     5   0   1</span></span>
<span><span class="co">#&gt; 6     6   0   1</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 244 rows ]</span></span></code></pre></div>
<p>Often we are interested in some additional covariates. Internally the
package uses multivariate normal distributions, so we need to specify
the mean and (co-)variance. We have the option to specify different
distribution parameters for the internal and external arms. The internal
arms are assumed to be randomized and therefore come from the same
distribution. If no external parameters are specified, the internal ones
are used for both.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">with_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_baseline_object.html">create_baseline_object</a></span><span class="op">(</span></span>
<span>  n_trt_int <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_ctrl_int <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  n_ctrl_ext <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="../reference/baseline_covariates.html">baseline_covariates</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>    means_int <span class="op">=</span> <span class="fl">55</span>,</span>
<span>    covariance_int <span class="op">=</span> <span class="fu"><a href="../reference/covariance_matrix.html">covariance_matrix</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="va">with_age</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulated Baseline Data</span></span>
<span><span class="co">#&gt;   patid ext trt      age</span></span>
<span><span class="co">#&gt; 1     1   0   1 53.74674</span></span>
<span><span class="co">#&gt; 2     2   0   1 54.48531</span></span>
<span><span class="co">#&gt; 3     3   0   1 58.48538</span></span>
<span><span class="co">#&gt; 4     4   0   1 55.15766</span></span>
<span><span class="co">#&gt; 5     5   0   1 55.28910</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 245 rows ]</span></span></code></pre></div>
<p>In a more complex setting, we can generate correlated baseline
covariates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">with_age_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_baseline_object.html">create_baseline_object</a></span><span class="op">(</span></span>
<span>  n_trt_int <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_ctrl_int <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  n_ctrl_ext <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="../reference/baseline_covariates.html">baseline_covariates</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"score"</span><span class="op">)</span>,</span>
<span>    means_int <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    means_ext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    covariance_int <span class="op">=</span> <span class="fu"><a href="../reference/covariance_matrix.html">covariance_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data_age_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="va">with_age_score</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">data_age_score</span><span class="op">$</span><span class="va">age</span>,</span>
<span>  y <span class="op">=</span> <span class="va">data_age_score</span><span class="op">$</span><span class="va">score</span>,</span>
<span>  col <span class="op">=</span> <span class="va">data_age_score</span><span class="op">$</span><span class="va">trt</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>  pch <span class="op">=</span> <span class="va">data_age_score</span><span class="op">$</span><span class="va">ext</span> <span class="op">*</span> <span class="fl">16</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Score"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"topright"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"internal treated"</span>, <span class="st">"internal control"</span>, <span class="st">"external control"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure-data_simulation-unnamed-chunk-6-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-6</p>
</div>
<p>Finally, we have the option to transform non-normal covariates, such
as with binary cut-offs. These can be added to existing objects and can
use built-in functions or used defined.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">with_age_score</span><span class="op">@</span><span class="va">transformations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  score_high <span class="op">=</span> <span class="fu"><a href="../reference/binary_cutoff.html">binary_cutoff</a></span><span class="op">(</span><span class="st">"score"</span>, int_cutoff <span class="op">=</span> <span class="fl">0.7</span>, ext_cutoff <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>  score_rounded <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">score</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/generate.html">generate</a></span><span class="op">(</span><span class="va">with_age_score</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulated Baseline Data</span></span>
<span><span class="co">#&gt;   patid ext trt      age    score score_high score_rounded</span></span>
<span><span class="co">#&gt; 1     1   0   1 53.74674 4.769823          0             5</span></span>
<span><span class="co">#&gt; 2     2   0   1 58.48538 5.070508          0             5</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 248 rows ]</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Secrest, Isaac Gravestock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
