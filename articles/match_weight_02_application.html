<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="psborrow2">
<title>2. Matching and Weighting Application with Dynamic Borrowing • psborrow2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Matching and Weighting Application with Dynamic Borrowing">
<meta property="og:description" content="psborrow2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">psborrow2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/psborrow2.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Genentech/psborrow2">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>2. Matching and Weighting Application with Dynamic Borrowing</h1>
                        <h4 data-toc-skip class="author">Manoj Khanal <a href="mailto:khanal_manoj@lilly.com" class="email">khanal_manoj@lilly.com</a>
</h4>
                        <h4 data-toc-skip class="author">Eli Lilly &amp;
Company</h4>
            
            <h4 data-toc-skip class="date">2024-04-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Genentech/psborrow2/blob/HEAD/vignettes/match_weight_02_application.Rmd" class="external-link"><code>vignettes/match_weight_02_application.Rmd</code></a></small>
      <div class="d-none name"><code>match_weight_02_application.Rmd</code></div>
    </div>

    
    
<p>In the <a href="https://genentech.github.io/psborrow2/articles/match_weight_01_methods.html">previous
article on matching/weighting methods</a>, we had used various
matching/weighting methods to minimize selection bias. In this article,
we will use matched/weighted cohort for Bayesian dynamic borrowing. This
article is a follow-up to the matching/weighting article, which
demonstrates methods to mitigate selection bias when designing
externally controlled trial. In this article, we will illustrate
Bayesian dynamic borrowing approaches using the matched and weighted
cohort. We will use the <code>psborrow2</code><span class="citation">(Isaac Gravestock 2024)</span> R package to demonstrate
the use of Bayesian methods with an example for time to event outcome.
In addition to using <code>psborrow2</code> package, we will also
demonstrate how to implement power and commensurate prior models with
piecewise exponential baseline hazard function.</p>
<p>We consider the following time to event outcome models in this
article</p>
<ul>
<li>Exponential distribution with constant hazard</li>
<li>Weibull distribution with proportional hazards parametrization</li>
<li>Piecewise Exponential distribution (not implemented yet in
<code>psborrow2</code> R package)</li>
</ul>
<p>We will also consider several Bayesian dynamic borrowing methods</p>
<ul>
<li>Commensurate prior</li>
<li>Power prior</li>
</ul>
<div class="section level2">
<h2 id="hazard-function">Hazard function<a class="anchor" aria-label="anchor" href="#hazard-function"></a>
</h2>
<p>The hazard function of <span class="math inline">\(T\)</span> at time
<span class="math inline">\(t\)</span> is defined as the instantaneous
rate of the event occurence that is still at risk at time <span class="math inline">\(t\)</span>. It is defined as</p>
<p><span class="math display">\[\begin{equation}
  h(t)=\lim_\limits{\Delta \rightarrow 0 } P\frac{(t\leq T&lt;t+\Delta
t|T\geq t)}{\Delta t}=\frac{f(t)}{S(t)},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(f(t)\)</span> is the density
function of <span class="math inline">\(T\)</span> given <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(S(t)=P(T&gt;t)\)</span> is the survival function
of <span class="math inline">\(T\)</span>.</p>
</div>
<div class="section level2">
<h2 id="cox-proportional-hazards-model">Cox proportional hazards model<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards-model"></a>
</h2>
<p>We start with the Cox proportional hazards model <span class="citation">(Cox 1972)</span> for observation <span class="math inline">\(i\)</span> as follows. To estimate the regression
coefficients under the Bayesian framework, the baseline hazard function
needs to be specified. This is not the case under a Frequentist Cox
regression. The hazard at time <span class="math inline">\(t\)</span>
is</p>
<p><span class="math display">\[\begin{equation}
\label{eq:coxmodel}
  \lambda(t|\boldsymbol{X}_i,Z_i)=\lambda_0(t|\alpha) \exp(\gamma Z_i
+\beta^T \boldsymbol{X}_i),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{X}_i\)</span> is the
vector of baseline covariates and <span class="math inline">\(Z_i\)</span> is the treatment indicator.</p>
</div>
<div class="section level2">
<h2 id="baseline-hazard-function">Baseline hazard function<a class="anchor" aria-label="anchor" href="#baseline-hazard-function"></a>
</h2>
<p>Baseline hazard functions can be modeled using common probability
distributions in survival analysis, such as exponential, Weibull, and
Gompertz. However, these standard specifications have limited
flexibility and cannot capture irregular behaviors. Alternatively, more
flexible hazard shapes can be specified using piecewise constant,
piecewise exponential or spline functions, allowing for the
representation of multimodal patterns and accommodating diverse
irregularities <span class="citation">(Lázaro, Armero, and Alvares
2021)</span>. The misspecification of the baseline hazard can lead to
the loss of important model details which can be challenging to
accurately estimate outcomes of interest, such as probabilities or
survival curves. In this article, we consider the following baseline
hazard functions.</p>
<ul>
<li>Exponential distribution with constant hazard
<ul>
<li><span class="math inline">\(\lambda_0(t|\alpha)=exp(\alpha)\)</span></li>
</ul>
</li>
<li>Weibull distribution with proportional hazards parametrization
<ul>
<li>
<span class="math inline">\(\lambda_0(t|\zeta,\mu)=\alpha
t\mu^{\zeta -1} \exp(-\mu t^\zeta)\)</span> with shape parameter <span class="math inline">\(\zeta\)</span> and scale parameter <span class="math inline">\(\mu\)</span>.</li>
</ul>
</li>
<li>Piecewise exponential distribution
<ul>
<li>
<span class="math inline">\(\lambda_0(t|\alpha_1,...,\alpha_K)=exp(\alpha_k)\)</span>
for <span class="math inline">\(t \in (s_{k-1},s_k],\)</span> where
<span class="math inline">\((s_{k-1},s_k]\)</span> is the <span class="math inline">\(k^{th}\)</span> interval and <span class="math inline">\(K\)</span> is the total number of pre-specified
intervals as in <span class="citation">Murray et al. (2014)</span>. In
our example below, we will consider <span class="math inline">\(s_k=(100*k/K)^{th}\)</span> to the percentile of
the event times from the treated group.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="likelihood">Likelihood<a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h2>
<p>We now introduce the likelihood along with the weight <span class="math inline">\(w_i\)</span> which is a subject specific weight.
For the purpose of demonstration, we have considered the subject
specific weight from inverse probability of treatment weighting method
estimating ATT. In other words, <span class="math inline">\(w_i=1\)</span> for subject <span class="math inline">\(i\)</span> in RCT and <span class="math inline">\(0 \leq w_i \leq 1\)</span> for subject <span class="math inline">\(i\)</span> in RWD. Let <span class="math inline">\({Y}_{i}\)</span> be the observed time, <span class="math inline">\({\delta}_{i}\)</span> be an event indicator, <span class="math inline">\(\boldsymbol{X}_{i}\)</span> be the covariates, and
<span class="math inline">\({Z}_{i}\)</span> be the treatment indicator
in the trial data. Similarly, let <span class="math inline">\({Y}_{0,i}\)</span> be the observed time, <span class="math inline">\({\delta}_{0,i}\)</span> be an event indicator,
<span class="math inline">\(\boldsymbol{X}_{0,i}\)</span> be the
covariates and <span class="math inline">\({Z}_{0,i}\)</span> be the
treatment indicator in external control data. The time axis is
partitioned into <span class="math inline">\(K\)</span> intervals: <span class="math inline">\((0,\kappa_1],(\kappa_1,\kappa_2],\ldots,(\kappa_{K-1},\kappa_K)\)</span>.
Let <span class="math inline">\(\lambda_0(t|\alpha_k)=\exp{(\alpha_k)}\)</span> be
the piecewise exponential baseline hazard function with <span class="math inline">\(t \in I_k=(\kappa_{k-1},\kappa_k)\)</span> for
<span class="math inline">\(k=1,\ldots,K\)</span>. Denote <span class="math inline">\(\boldsymbol{\alpha}=(\alpha_1,\ldots,\alpha_K)^\intercal\)</span>.
Let <span class="math inline">\(\boldsymbol\beta\)</span> and <span class="math inline">\(\gamma\)</span> be the covariate and treatment
effects respectively in trial. Similarly, let <span class="math inline">\(\boldsymbol{\beta}_0\)</span> and <span class="math inline">\(\boldsymbol{\alpha}_0\)</span> represent the
parameters in external control.</p>
<p>The joint likelihood of trial and external control for right censored
observations after taking account the weight <span class="math inline">\(w_i\)</span> with baseline hazard as a piecewise
exponential function and <span class="math inline">\(K\)</span>
intervals can be written by slightly extending <span class="citation">Murray et al. (2014)</span> as</p>
<p><span class="math display">\[
\begin{equation}
        \small
        \begin{split}
             &amp;
L(\boldsymbol{\alpha},\boldsymbol{\beta},\boldsymbol{\gamma},\boldsymbol{\alpha}_0,\boldsymbol{\beta}_0
|\boldsymbol{D},\boldsymbol{D}_0 )   \\ &amp;
=  L(\boldsymbol{\alpha},\boldsymbol{\beta},\boldsymbol{\gamma}|\boldsymbol{D},\boldsymbol
\mu) L(\boldsymbol{\alpha}_0,\boldsymbol{\beta}_0|\boldsymbol{D}_0) \\
            &amp; =\prod_{i=1}^n  \prod_{k=1}^K
\Bigg[\exp{\bigg\{\mathcal I(Y_{i} \in I_k)\mathcal
S_{ik}\bigg\}}^{\delta_{i}}
            \exp\bigg\{-\mathcal I(Y_{i} \in I_k) \bigg(
\sum_{\ell=1}^{k-1} (\kappa_\ell  -  \kappa_{\ell-1}) \\
            &amp; \times \exp{(\mathcal S_{i\ell})}
             + (Y_{i} - \kappa_{k-1}) \exp{(\mathcal S_{ik}) } \bigg)
\bigg\} \Bigg]
             \Bigg[ \exp{\bigg\{\mathcal I(Y_{0,i} \in I_k)  \mathcal
S_{0,ik} \bigg\} }^{\delta_{0,i}} \\
          &amp; \times \exp\bigg\{-\mathcal I(Y_{0,i} \in I_k)
            \bigg( \sum_{\ell=1}^{k-1} (\kappa_\ell -
\kappa_{\ell-1})\exp{(\mathcal S_{0,i\ell})}
             + (Y_{0,i} - \kappa_{k-1})\\
             &amp; \times \exp{(\mathcal S_{0,ik}) } \bigg)  \bigg\}
\Bigg],
        \end{split}
    \end{equation}
    \]</span></p>
<p>where <span class="math inline">\(\mathcal S_{0,ik}=\alpha_{0,k} +
\boldsymbol{\beta}_0^\intercal \boldsymbol{X}_{0,i}\)</span>, <span class="math inline">\(\mathcal S_{ik}=\alpha_{k} +
\boldsymbol{\beta}^\intercal \boldsymbol{X}_{i} + {\gamma}
{Z}_{i}\)</span>, <span class="math inline">\(n=n_T+n_E\)</span>; <span class="math inline">\(n_T\)</span> and <span class="math inline">\(n_E\)</span> are the sample size in trial and
external control data respectively. If <span class="math inline">\(w_i=1\)</span>, then the above likelihood becomes
the traditional likelihood for Cox proportional hazards model. Above
notations are similar as in <span class="citation">Khanal
(2022)</span>.</p>
<p>The joint likelihood can also be constructed in a similar way for
other baseline hazard functions.</p>
</div>
<div class="section level2">
<h2 id="power-prior-model">Power prior model<a class="anchor" aria-label="anchor" href="#power-prior-model"></a>
</h2>
<p>We denote the data for the randomized controlled trial (RCT) as <span class="math inline">\(D_1\)</span> with the corresponding likelihood as
<span class="math inline">\(L(\gamma,\beta,\alpha│D_1 )\)</span> and
external control (EC) data as <span class="math inline">\(D_0\)</span>
with corresponding likelihood as <span class="math inline">\(L(\gamma,\beta,\alpha│D_0)\)</span>. The
formulation of power prior is <span class="citation">(Ibrahim et al.
2015)</span> <span class="math display">\[p(\gamma,\beta,\alpha│D_0,ν)
\propto L(\gamma,\beta,\alpha│D_0
)^ν  *p(\gamma)*p(\beta)*p(\alpha),\]</span> where <span class="math inline">\(0 \leq ν \leq 1\)</span> is the vector of subject
specific weights in the EC data, and <span class="math inline">\(p(\gamma)\)</span>, <span class="math inline">\(p(\beta)\)</span>, and <span class="math inline">\(p(\alpha)\)</span> are the priors for <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\alpha\)</span> respectively.</p>
<p>The posterior distribution is <span class="math display">\[p(\beta│D_1,D_0,ν) \propto
L(\gamma,\beta,\alpha│D_1 )  L(\gamma,\beta,\alpha│D_0
)^ν  *p(\gamma)*p(\beta)*p(\alpha).\]</span></p>
<p>We consider the non-informative prior distributions for the
parameters as <span class="math inline">\(\gamma \sim
N(0,0.001)\)</span>, <span class="math inline">\(\beta_j \sim
N(0,0.001)\)</span> for <span class="math inline">\(j=1...,P\)</span>
with <span class="math inline">\(P\)</span> baseline covariates, and
<span class="math inline">\(\alpha_k \sim N(0,0.001)\)</span> for <span class="math inline">\(k=1,...,K\)</span> intervals.</p>
<p>Note: To avoid confusion, <span class="math inline">\(N(a,b)\)</span>
means a normal distribution with mean <span class="math inline">\(a\)</span> and precision <span class="math inline">\(b\)</span>.</p>
</div>
<div class="section level2">
<h2 id="commensurate-prior-model">Commensurate prior model<a class="anchor" aria-label="anchor" href="#commensurate-prior-model"></a>
</h2>
<p>Let <span class="math inline">\(\boldsymbol{\eta}=(\beta_1,...,\beta_P,\alpha_1,...,\alpha_K)\)</span>
and <span class="math inline">\(\boldsymbol{\eta}_0=(\beta_{10},...,\beta_{P0},\alpha_{10},...,\alpha_{K0})\)</span>
be the parameter vector for RCT and RWD respectively. We consider the
following commensurate prior</p>
<p><span class="math display">\[\eta_\ell|\eta_{0,\ell},\tau_\ell \sim
N(\eta_{\ell 0},\tau_\ell) \quad \quad \ell=1,\cdots,P+K,\]</span></p>
<p>where <span class="math inline">\(\tau_\ell\)</span> is the precision
parameter that determines the degree of borrowing, <span class="math inline">\(P\)</span> is the total number of covariates and
<span class="math inline">\(K\)</span> is the total number of intervals.
For the precision parameter, we assign a gamma prior as <span class="math inline">\(\tau_\ell \sim Gamma(0.01,0.01)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="conducting-analysis">Conducting Analysis<a class="anchor" aria-label="anchor" href="#conducting-analysis"></a>
</h2>
<p>We first load the following libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Loading the libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">R2jags</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Genentech/psborrow2" class="external-link">psborrow2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>We also load the data set <code>data_with_weights</code>.</p>
<ul>
<li>The continuous variables are
<ul>
<li>
<code>Age</code> (years)</li>
<li>
<code>Weight</code> (lbs)</li>
<li>
<code>Height</code> (inches)</li>
<li><code>Biomarker1</code></li>
<li><code>Biomarker2</code></li>
</ul>
</li>
<li>The categorical variables are
<ul>
<li>
<code>Smoker</code>: Yes = 1 and No = 0</li>
<li>
<code>Sex</code>: Male = 1 and Female = 0</li>
<li>
<code>ECOG1</code>: ECOG 1 = 1 and ECOG 0 = 0</li>
</ul>
</li>
<li>The treatment indicator is
<ul>
<li>
<code>group</code>: group = 1 is treatment and group = 0 is
placebo</li>
</ul>
</li>
<li>The time to event variable is
<ul>
<li><code>time</code></li>
</ul>
</li>
<li>The event indicator variable is
<ul>
<li>
<code>event</code>: event = 1 represents an event occurred and event
= 0 indicates the event was censored</li>
</ul>
</li>
<li>The data source indicator variable is
<ul>
<li>
<code>indicator</code>: indicator=1 is the RCT data and indicator=0
is the EC data</li>
</ul>
</li>
<li>The estimated weights after applying matching/weighting methods are
<ul>
<li>
<code>ratio1_caliper_weights_lps</code>: Weights after 1:1 Nearest
Neighbor Propensity score matching with a caliper width of 0.2 of the
standard deviation of the logit of the propensity score</li>
<li>
<code>ratio_caliper_weights</code>: Weights after 1:1 Nearest
Neighbor Propensity score matching with a caliper width of 0.2 of the
standard deviation of raw propensity score</li>
<li>
<code>genetic_ratio1_weights</code>: Weights after 1:1 Genetic
matching with replacement</li>
<li>
<code>genetic_ratio1_weights_no_replace</code>: Weights after 1:1
Genetic matching without replacement</li>
<li>
<code>optimal_ratio1_weights</code>: Weights after 1:1 Optimal
matching</li>
<li>
<code>weights_gbm</code>: Weights (ATT) after using Generalized
Boosted Model to estimate propensity score</li>
<li>
<code>eb_weights</code>: Weights (ATT) after Entropy Balancing</li>
<li>
<code>invprob_weights</code>: Weights (ATT) after Inverse
Probability Treatment Weighting using logistic regression</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data_with_weights.csv"</span><span class="op">)</span></span>
<span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">cnsr</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">data_with_weights</span><span class="op">$</span><span class="va">event</span></span>
<span><span class="va">data_with_weights</span> <span class="op">&lt;-</span> <span class="va">data_with_weights</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">data_with_weights</span>, <span class="va">class</span><span class="op">)</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"numeric"</span>, <span class="st">"integer"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">data_with_weights</span><span class="op">$</span><span class="va">indicator</span> <span class="co">#External control flag</span></span>
<span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">norm.weights</span><span class="op">=</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">invprob_weights</span></span>
<span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">norm.weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">ext</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">norm.weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">ext</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">norm.weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">ext</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">data_with_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span></code></pre></div>
<p>The first six observations of the data set is shown below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;           Age   Weight   Height Biomarker1 Biomarker2 Smoker Sex ECOG1 group</span></span>
<span><span class="co">#&gt; [1,] 55.51419 148.5092 65.63899   33.71898   55.26178      0   1     0     1</span></span>
<span><span class="co">#&gt; [2,] 49.93326 146.9441 63.44883   35.65828   45.50928      1   1     1     1</span></span>
<span><span class="co">#&gt; [3,] 58.51588 153.5435 70.53193   35.53710   55.89283      0   1     0     0</span></span>
<span><span class="co">#&gt; [4,] 48.61226 147.2873 64.10615   31.17663   55.80523      0   1     0     1</span></span>
<span><span class="co">#&gt; [5,] 51.84943 151.0312 62.16361   33.99677   48.01981      0   1     0     0</span></span>
<span><span class="co">#&gt; [6,] 51.81743 148.1115 68.69766   33.82398   47.32652      1   1     0     0</span></span>
<span><span class="co">#&gt;           time event indicator ratio1_caliper_weights_lps</span></span>
<span><span class="co">#&gt; [1,] 0.4089043     0         1                          0</span></span>
<span><span class="co">#&gt; [2,] 0.9721405     0         1                          1</span></span>
<span><span class="co">#&gt; [3,] 0.2956919     0         1                          0</span></span>
<span><span class="co">#&gt; [4,] 4.3111823     0         1                          0</span></span>
<span><span class="co">#&gt; [5,] 0.2644848     0         1                          0</span></span>
<span><span class="co">#&gt; [6,] 0.3103544     0         1                          0</span></span>
<span><span class="co">#&gt;      ratio1_caliper_weights genetic_ratio1_weights</span></span>
<span><span class="co">#&gt; [1,]                      0                      1</span></span>
<span><span class="co">#&gt; [2,]                      1                      1</span></span>
<span><span class="co">#&gt; [3,]                      0                      1</span></span>
<span><span class="co">#&gt; [4,]                      1                      1</span></span>
<span><span class="co">#&gt; [5,]                      0                      1</span></span>
<span><span class="co">#&gt; [6,]                      0                      1</span></span>
<span><span class="co">#&gt;      genetic_ratio1_weights_no_replace optimal_ratio1_weights weights_gbm</span></span>
<span><span class="co">#&gt; [1,]                                 1                      0           1</span></span>
<span><span class="co">#&gt; [2,]                                 0                      1           1</span></span>
<span><span class="co">#&gt; [3,]                                 1                      0           1</span></span>
<span><span class="co">#&gt; [4,]                                 1                      0           1</span></span>
<span><span class="co">#&gt; [5,]                                 1                      1           1</span></span>
<span><span class="co">#&gt; [6,]                                 1                      1           1</span></span>
<span><span class="co">#&gt;      eb_weights invprob_weights cnsr ext norm.weights</span></span>
<span><span class="co">#&gt; [1,]          1               1    1   0            1</span></span>
<span><span class="co">#&gt; [2,]          1               1    1   0            1</span></span>
<span><span class="co">#&gt; [3,]          1               1    1   0            1</span></span>
<span><span class="co">#&gt; [4,]          1               1    1   0            1</span></span>
<span><span class="co">#&gt; [5,]          1               1    1   0            1</span></span>
<span><span class="co">#&gt; [6,]          1               1    1   0            1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="exponential-distribution-with-constant-hazard-with-gamma-prior-distribution-using-psborrow2-r-package">Exponential distribution with constant hazard with gamma prior
distribution (Using <code>psborrow2</code> R package)<a class="anchor" aria-label="anchor" href="#exponential-distribution-with-constant-hazard-with-gamma-prior-distribution-using-psborrow2-r-package"></a>
</h2>
<p>The <code>psborrow2</code> package will be used to conduct the
analysis.</p>
<p>We use exponential distribution for the outcome model as follows.
Non-informative normal prior is used for the baseline parameter. The
data <code>data_with_weights</code> contain the time and censoring
variable. For demonstration purpose, we choose the subject level weight
<code>invprob_weights</code> calculated using inverse probability of
treatment weighting (IPTW). In this step we extract the time, censoring
indicator and the normalized weight variables denoted by
<code>time</code>, <code>cnsr</code> and <code>norm.weights</code>
respectively.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Outcome</span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outcome_surv_exponential.html">outcome_surv_exponential</a></span><span class="op">(</span></span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  cens_var <span class="op">=</span> <span class="st">"cnsr"</span>,</span>
<span>  baseline_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  weight_var <span class="op">=</span> <span class="st">"norm.weights"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span></span>
<span><span class="co">#&gt; Outcome object with class OutcomeSurvExponential </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outcome variables:</span></span>
<span><span class="co">#&gt;       time_var       cens_var     weight_var </span></span>
<span><span class="co">#&gt;         "time"         "cnsr" "norm.weights" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Baseline prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Next, the borrowing method is implemented as shown below. We consider
Bayesian Dynamic Borrowing (BDB) in which gamma prior is assigned for
the commensurability parameter. The <code>tau_prior</code> shown below
is the hyperparameter of the commensurate prior which determines the
degree of borrowing. We assign a gamma prior for this hyperparameter.
Furhtermore, we also need to specify a flag for external data which is
denoted by <code>ext</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Borrowing</span></span>
<span><span class="va">borrowing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/borrowing_hierarchical_commensurate.html">borrowing_hierarchical_commensurate</a></span><span class="op">(</span></span>
<span>  ext_flag_col <span class="op">=</span> <span class="st">"ext"</span>,</span>
<span>  tau_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_gamma.html">prior_gamma</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">borrowing</span></span>
<span><span class="co">#&gt; Borrowing object using the  Bayesian dynamic borrowing with the hierarchical commensurate prior  approach</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; External control flag: ext </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Commensurability parameter prior:</span></span>
<span><span class="co">#&gt; Gamma Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R     Value</span></span>
<span><span class="co">#&gt;  alpha shape 0.001</span></span>
<span><span class="co">#&gt;  beta  rate  0.001</span></span>
<span><span class="co">#&gt; Constraints: &lt;lower=0&gt;</span></span></code></pre></div>
<p>Similarly, details regarding the treatment variable is specified
below. A Non-informative prior is used for the treatment effect
parameter <span class="math inline">\(\gamma\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Treatment</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/treatment_details.html">treatment_details</a></span><span class="op">(</span></span>
<span>  trt_flag_col <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  trt_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">treatment</span></span>
<span><span class="co">#&gt; Treatment object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment flag column: group </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment effect prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Now, all the pieces are brought together to create the analysis
object as shown below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Application</span></span>
<span><span class="va">anls_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_analysis_obj.html">create_analysis_obj</a></span><span class="op">(</span></span>
<span>  data_matrix <span class="op">=</span> <span class="va">data_with_weights</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>  borrowing <span class="op">=</span> <span class="va">borrowing</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">treatment</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Inputs look good.</span></span>
<span><span class="co">#&gt; Stan program compiled successfully!</span></span>
<span><span class="co">#&gt; Ready to go! Now call `mcmc_sample()`.</span></span></code></pre></div>
<p>Finally, we run the MCMC sample for <span class="math inline">\(10,000\)</span> iterations with <span class="math inline">\(3\)</span> chains.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">niter</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="va">results.exp.psborrow</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc_sample.html">mcmc_sample</a></span><span class="op">(</span><span class="va">anls_obj</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  iter_sampling <span class="op">=</span> <span class="va">niter</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 3 sequential chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 11.5 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 13.0 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 13.1 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 3 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 12.5 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 38.0 seconds.</span></span>
<span></span>
<span><span class="va">draws1</span> <span class="op">&lt;-</span> <span class="va">results.exp.psborrow</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">draws1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename_draws_covariates.html">rename_draws_covariates</a></span><span class="op">(</span><span class="va">draws1</span>, <span class="va">anls_obj</span><span class="op">)</span></span></code></pre></div>
<p>The summary is shown below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.exp.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 10</span></span>
<span><span class="co">#&gt;   variable      mean    median     sd    mad          q5      q95  rhat ess_bulk</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__     -709.     -709.     1.50   1.30   -712.       -707.     1.00   10252.</span></span>
<span><span class="co">#&gt; 2 beta_trt   -0.0370   -0.0373 0.117  0.117    -0.230       0.157  1.00   12902.</span></span>
<span><span class="co">#&gt; 3 tau         0.0838    0.0370 0.122  0.0506    0.000343    0.326  1.00   12113.</span></span>
<span><span class="co">#&gt; 4 alpha[1]   -0.945    -0.943  0.0992 0.0996   -1.11       -0.784  1.00   12636.</span></span>
<span><span class="co">#&gt; 5 alpha[2]    2.56      2.58   0.316  0.314     2.01        3.05   1.00   18595.</span></span>
<span><span class="co">#&gt; 6 HR_trt      0.970     0.963  0.114  0.113     0.795       1.17   1.00   12902.</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: ess_tail &lt;dbl&gt;</span></span></code></pre></div>
<p>The histogram of the posterior samples for hazard ratio and
commensurability parameter as shown below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="va">draws1</span>, <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10"><p class="caption">
plot of chunk unnamed-chunk-10
</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="va">draws1</span>, <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"commensurability parameter"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-10-2.png" alt="plot of chunk unnamed-chunk-10"><p class="caption">
plot of chunk unnamed-chunk-10
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span></code></pre></div>
<p>The <span class="math inline">\(95\%\)</span> credible interval can
be calculated as follows.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws1</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   variable                                 `2.5%`  `97.5%`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__                               -713.        -707.   </span></span>
<span><span class="co">#&gt; 2 treatment log HR                     -0.266        0.195</span></span>
<span><span class="co">#&gt; 3 commensurability parameter            0.0000886    0.428</span></span>
<span><span class="co">#&gt; 4 baseline log hazard rate, internal   -1.14        -0.754</span></span>
<span><span class="co">#&gt; 5 baseline log hazard rate, external    1.90         3.14 </span></span>
<span><span class="co">#&gt; 6 treatment HR                          0.767        1.21</span></span></code></pre></div>
<p>We can graph other plots that help us evaluate convergence and
diagnose problems with the MCMC sampler, such as trace plot.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span></span>
<span>  <span class="va">draws1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, <span class="co"># Using a subset of draws only</span></span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span>, <span class="st">"commensurability parameter"</span><span class="op">)</span>,</span>
<span>  n_warmup <span class="op">=</span> <span class="va">niter</span><span class="op">/</span><span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12"><p class="caption">
plot of chunk unnamed-chunk-12
</p>
</div>
</div>
<div class="section level2">
<h2 id="time-to-event-analysis-with-weibull-distribution-and-proportional-hazards-parametrization">Time-to-event analysis with Weibull distribution and proportional
hazards parametrization<a class="anchor" aria-label="anchor" href="#time-to-event-analysis-with-weibull-distribution-and-proportional-hazards-parametrization"></a>
</h2>
<p>We conduct analysis using a Weibull distribution for the outcome
model using the <code>psborrow2</code> package as follows.</p>
<p>Non-informative normal prior is used for the baseline parameter <span class="math inline">\(\mu\)</span>. An exponential prior is used for the
Weibull shape parameter <span class="math inline">\(\zeta\)</span>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Outcome</span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outcome_surv_weibull_ph.html">outcome_surv_weibull_ph</a></span><span class="op">(</span></span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  cens_var <span class="op">=</span> <span class="st">"cnsr"</span>,</span>
<span>  shape_prior<span class="op">=</span><span class="fu"><a href="../reference/prior_exponential.html">prior_exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  baseline_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  weight_var <span class="op">=</span> <span class="st">"norm.weights"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span></span>
<span><span class="co">#&gt; Outcome object with class OutcomeSurvWeibullPH </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outcome variables:</span></span>
<span><span class="co">#&gt;       time_var       cens_var     weight_var </span></span>
<span><span class="co">#&gt;         "time"         "cnsr" "norm.weights" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Baseline prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; shape_weibull prior:</span></span>
<span><span class="co">#&gt; Exponential Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan R    Value</span></span>
<span><span class="co">#&gt;  beta rate 1    </span></span>
<span><span class="co">#&gt; Constraints: &lt;lower=0&gt;</span></span></code></pre></div>
<p>Next, the borrowing method is implemented as shown below. We consider
Bayesian Dynamic Borrowing (BDB) in which a non-informative gamma prior
is assigned for the commensurability parameter.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Borrowing</span></span>
<span><span class="va">borrowing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/borrowing_hierarchical_commensurate.html">borrowing_hierarchical_commensurate</a></span><span class="op">(</span></span>
<span>  ext_flag_col <span class="op">=</span> <span class="st">"ext"</span>,</span>
<span>  tau_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_gamma.html">prior_gamma</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">borrowing</span></span>
<span><span class="co">#&gt; Borrowing object using the  Bayesian dynamic borrowing with the hierarchical commensurate prior  approach</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; External control flag: ext </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Commensurability parameter prior:</span></span>
<span><span class="co">#&gt; Gamma Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R     Value</span></span>
<span><span class="co">#&gt;  alpha shape 0.001</span></span>
<span><span class="co">#&gt;  beta  rate  0.001</span></span>
<span><span class="co">#&gt; Constraints: &lt;lower=0&gt;</span></span></code></pre></div>
<p>Similarly, details regarding the treatment variable are specified
below. Non-informative prior is used for treatment effect <span class="math inline">\(\gamma\)</span>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Treatment</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/treatment_details.html">treatment_details</a></span><span class="op">(</span></span>
<span>  trt_flag_col <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  trt_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">treatment</span></span>
<span><span class="co">#&gt; Treatment object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment flag column: group </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment effect prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Now, all the pieces are brought together to create the analysis
object as shown below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Application</span></span>
<span><span class="va">data_with_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span><span class="va">anls_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_analysis_obj.html">create_analysis_obj</a></span><span class="op">(</span></span>
<span>  data_matrix <span class="op">=</span> <span class="va">data_with_weights</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>  borrowing <span class="op">=</span> <span class="va">borrowing</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">treatment</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Inputs look good.</span></span>
<span><span class="co">#&gt; Stan program compiled successfully!</span></span>
<span><span class="co">#&gt; Ready to go! Now call `mcmc_sample()`.</span></span></code></pre></div>
<p>Finally, we run the MCMC sample for <span class="math inline">\(10,000\)</span> iterations with <span class="math inline">\(3\)</span> chains.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.weib.psborrow</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc_sample.html">mcmc_sample</a></span><span class="op">(</span><span class="va">anls_obj</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  iter_sampling <span class="op">=</span> <span class="va">niter</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 3 sequential chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 29.2 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 33.2 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 29.7 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 3 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 30.7 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 92.5 seconds.</span></span>
<span></span>
<span><span class="va">draws2</span> <span class="op">&lt;-</span> <span class="va">results.weib.psborrow</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">draws2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename_draws_covariates.html">rename_draws_covariates</a></span><span class="op">(</span><span class="va">draws2</span>, <span class="va">anls_obj</span><span class="op">)</span></span></code></pre></div>
<p>The summary is shown below.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.weib.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 10</span></span>
<span><span class="co">#&gt;   variable          mean   median     sd    mad       q5      q95  rhat ess_bulk</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__          -6.96e+2 -6.96e+2 1.63   1.48   -6.99e+2 -694.     1.00   11832.</span></span>
<span><span class="co">#&gt; 2 beta_trt      -2.84e-2 -2.87e-2 0.117  0.118  -2.20e-1    0.166  1.00   16067.</span></span>
<span><span class="co">#&gt; 3 shape_weibull  8.19e-1  8.18e-1 0.0324 0.0324  7.67e-1    0.873  1.00   20840.</span></span>
<span><span class="co">#&gt; 4 tau            1.23e-1  5.50e-2 0.179  0.0750  5.65e-4    0.474  1.00   15655.</span></span>
<span><span class="co">#&gt; 5 alpha[1]      -7.76e-1 -7.75e-1 0.103  0.104  -9.49e-1   -0.611  1.00   16026.</span></span>
<span><span class="co">#&gt; 6 alpha[2]       2.14e+0  2.15e+0 0.326  0.325   1.58e+0    2.65   1.00   21336.</span></span>
<span><span class="co">#&gt; 7 HR_trt         9.79e-1  9.72e-1 0.116  0.115   8.03e-1    1.18   1.00   16067.</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: ess_tail &lt;dbl&gt;</span></span></code></pre></div>
<p>Histogram of the posterior samples for hazard ratio and
commensurability parameter are produced.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="va">draws2</span>, <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19"><p class="caption">
plot of chunk unnamed-chunk-19
</p>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="va">draws2</span>, <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"commensurability parameter"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-19-2.png" alt="plot of chunk unnamed-chunk-19"><p class="caption">
plot of chunk unnamed-chunk-19
</p>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span></code></pre></div>
<p>The <span class="math inline">\(95\%\)</span> credible interval can
be calculated as follows.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws2</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 3</span></span>
<span><span class="co">#&gt;   variable                                `2.5%`  `97.5%`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__                               -700.       -694.   </span></span>
<span><span class="co">#&gt; 2 treatment log HR                     -0.254       0.203</span></span>
<span><span class="co">#&gt; 3 Weibull shape parameter               0.757       0.884</span></span>
<span><span class="co">#&gt; 4 commensurability parameter            0.000142    0.617</span></span>
<span><span class="co">#&gt; 5 baseline log hazard rate, internal   -0.981      -0.582</span></span>
<span><span class="co">#&gt; 6 baseline log hazard rate, external    1.46        2.74 </span></span>
<span><span class="co">#&gt; 7 treatment HR                          0.776       1.22</span></span></code></pre></div>
<p>We can see other plots that help us evaluate convergence and diagnose
problems with the MCMC sampler, such as trace plot.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span></span>
<span>  <span class="va">draws2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, <span class="co"># Using a subset of draws only</span></span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span>, <span class="st">"commensurability parameter"</span><span class="op">)</span>,</span>
<span>  n_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-21-1.png" alt="plot of chunk unnamed-chunk-21"><p class="caption">
plot of chunk unnamed-chunk-21
</p>
</div>
</div>
<div class="section level2">
<h2 id="power-prior-with-piecewise-exponential-distribution-not-implemented-in-psborrow2-r-package">Power prior with piecewise exponential distribution (not implemented
in <code>psborrow2</code> R package)<a class="anchor" aria-label="anchor" href="#power-prior-with-piecewise-exponential-distribution-not-implemented-in-psborrow2-r-package"></a>
</h2>
<p>We will consider the Bayesian power prior with subject specific power
parameters. The weights from various matching and weighting methods can
be used as subject specific power parameters for external control
subjects. The baseline hazard function will be based on piecewise
exponential distribution. The following JAGS code, adapted from <span class="citation">(Alvares et al. 2021)</span>, implements the power
prior with piecewise exponential baseline hazard. We will consider a
subject specific power parameter as the weights from inverse probability
weighting method. The subject specific weights for external control
patients are normalized by dividing each weight by the maximum
weight.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>model{</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>        <span class="co">#POWER PRIOR JAGS CODE</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  <span class="co">#Trial Data</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>    <span class="co"># Pieces of the cumulative hazard function</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>int.obs[i]) {</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>      cond[i,k] <span class="ot">&lt;-</span> <span class="fu">step</span>(time[i] <span class="sc">-</span> a[k <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>      HH[i , k] <span class="ot">&lt;-</span> cond[i,k] <span class="sc">*</span> (a[k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alpha[k]) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">-</span> cond[i,k] ) <span class="sc">*</span> (time[i] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alpha[k])</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>    }</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>    <span class="co"># Cumulative hazard function</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>    H[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(HH[i,<span class="dv">1</span> <span class="sc">:</span> int.obs[i]] )</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  }</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>    <span class="co"># Linear predictor</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>    elinpred[i] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">inprod</span>(beta[],X[i,]))</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>    <span class="co"># Log-hazard function</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>    logHaz[i] <span class="ot">&lt;-</span> <span class="fu">log</span>( <span class="fu">exp</span>(alpha[int.obs[i]]) <span class="sc">*</span> elinpred[i])</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>    <span class="co"># Log-survival function</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>    logSurv[i] <span class="ot">&lt;-</span> <span class="sc">-</span>H[i]  <span class="sc">*</span> elinpred[i]</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>    <span class="co"># Definition of the log-likelihood using zeros trick</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>    phi[i] <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">-</span> status[i] <span class="sc">*</span> logHaz[i] <span class="sc">-</span> logSurv[i]</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>    zeros[i] <span class="sc">~</span> <span class="fu">dpois</span>(phi[i])</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>  }</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>  <span class="co">#Real World or External Control Data</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nR){</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a>    <span class="co"># Pieces of the cumulative hazard function</span></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>int.obsR[i]) {</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>      condR[i,k] <span class="ot">&lt;-</span> <span class="fu">step</span>(timeR[i] <span class="sc">-</span> a[k <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a>      HHR[i , k] <span class="ot">&lt;-</span> condR[i,k] <span class="sc">*</span> (a[k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alpha[k]) <span class="sc">+</span></span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">-</span> condR[i,k] ) <span class="sc">*</span> (timeR[i] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alpha[k])</span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>    }</span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a>    <span class="co"># Cumulative hazard function</span></span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>    HR[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(HHR[i,<span class="dv">1</span> <span class="sc">:</span> int.obsR[i]] )</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>  }</span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nR) {</span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>    <span class="co"># Linear predictor</span></span>
<span id="cb26-39"><a href="#cb26-39" tabindex="-1"></a>    elinpredR[i] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">inprod</span>(beta[],XR[i,]))</span>
<span id="cb26-40"><a href="#cb26-40" tabindex="-1"></a>    <span class="co"># Log-hazard function</span></span>
<span id="cb26-41"><a href="#cb26-41" tabindex="-1"></a>    logHazR[i] <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">exp</span>(alpha[int.obsR[i]]) <span class="sc">*</span> elinpredR[i])</span>
<span id="cb26-42"><a href="#cb26-42" tabindex="-1"></a>    <span class="co"># Log-survival function</span></span>
<span id="cb26-43"><a href="#cb26-43" tabindex="-1"></a>    logSurvR[i] <span class="ot">&lt;-</span> <span class="sc">-</span>HR[i] <span class="sc">*</span> elinpredR[i]</span>
<span id="cb26-44"><a href="#cb26-44" tabindex="-1"></a>    <span class="co"># Definition of the log-likelihood using zeros trick</span></span>
<span id="cb26-45"><a href="#cb26-45" tabindex="-1"></a>    phiR[i] <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">-</span> rho[i] <span class="sc">*</span> statusR[i] <span class="sc">*</span> logHazR[i] <span class="sc">-</span> rho[i] <span class="sc">*</span> logSurvR[i] </span>
<span id="cb26-46"><a href="#cb26-46" tabindex="-1"></a>    <span class="co">#rho[i] is the subject level weight as a power prior</span></span>
<span id="cb26-47"><a href="#cb26-47" tabindex="-1"></a>    zerosR[i] <span class="sc">~</span> <span class="fu">dpois</span>(phiR[i])</span>
<span id="cb26-48"><a href="#cb26-48" tabindex="-1"></a>  }</span>
<span id="cb26-49"><a href="#cb26-49" tabindex="-1"></a>  <span class="co"># Prior distributions</span></span>
<span id="cb26-50"><a href="#cb26-50" tabindex="-1"></a>  <span class="cf">for</span>(l <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> Nbetas ){</span>
<span id="cb26-51"><a href="#cb26-51" tabindex="-1"></a>    beta[l] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span> , <span class="fl">0.001</span>)</span>
<span id="cb26-52"><a href="#cb26-52" tabindex="-1"></a>  }</span>
<span id="cb26-53"><a href="#cb26-53" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" tabindex="-1"></a>  <span class="cf">for</span>( k <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span>m) {</span>
<span id="cb26-55"><a href="#cb26-55" tabindex="-1"></a>  alpha[k] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.001</span>)</span>
<span id="cb26-56"><a href="#cb26-56" tabindex="-1"></a>  }</span>
<span id="cb26-57"><a href="#cb26-57" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" tabindex="-1"></a>} </span></code></pre></div>
<p>We now define all the variables as in input to JAGS.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_weights</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Trial Data</span></span>
<span><span class="va">trial.data</span> <span class="op">&lt;-</span> <span class="va">data_with_weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">indicator</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#External Control Data</span></span>
<span><span class="va">ext.control.data</span> <span class="op">&lt;-</span> <span class="va">data_with_weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">indicator</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#Input in JAGS code</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span> <span class="co">#Sample size in trial data</span></span>
<span><span class="va">nR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span> <span class="co">#Sample size in external control data</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">time</span> <span class="co">#Survival time in trial data</span></span>
<span><span class="va">timeR</span> <span class="op">&lt;-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span> <span class="co">#Survival time in external control data</span></span>
<span></span>
<span><span class="va">status</span> <span class="op">&lt;-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">event</span> <span class="co">#Event indicator in trial data</span></span>
<span><span class="va">statusR</span> <span class="op">&lt;-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">event</span> <span class="co">#Event indicator in external control data</span></span>
<span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">invprob_weights</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">$</span><span class="va">invprob_weights</span><span class="op">)</span> <span class="co">#Power prior weights</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="co">#Covariates in trial data</span></span>
<span><span class="va">XR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="co">#Covariates in external control data</span></span>
<span></span>
<span><span class="va">Nbetas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zeros</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">zerosR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nR</span><span class="op">)</span></span></code></pre></div>
<p>We also need to pre-specify the number of intervals. For simplicity,
we will consider <span class="math inline">\(K=1\)</span> interval.
However, this method also works <span class="math inline">\(K&gt;1\)</span>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Time axis partition</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># number of intervals</span></span>
<span></span>
<span><span class="co">#Cut points (Using the event times in trial data)</span></span>
<span><span class="va">a</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">trial.data</span><span class="op">$</span><span class="va">event</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">K</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">K</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">$</span><span class="va">time</span>,<span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">0.0001</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Trial data</span></span>
<span><span class="co"># int.obs: vector that tells us at which interval each observation is</span></span>
<span><span class="va">int.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">a</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">int.obs</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">k</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">int.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">int.obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#External control data</span></span>
<span><span class="co"># int.obs: vector that tells us at which interval each observation is</span></span>
<span><span class="va">int.obsR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">a</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">int.obsR</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">k</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">int.obsR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">int.obsR</span><span class="op">)</span></span></code></pre></div>
<p>We now put all variables into a list as data inputs for JAGs.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### JAGS ####</span></span>
<span><span class="va">d.jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"nR"</span>, <span class="st">"time"</span>, <span class="st">"timeR"</span>,</span>
<span>               <span class="st">"a"</span>, <span class="st">"X"</span>, <span class="st">"XR"</span>,<span class="st">"int.obs"</span>,</span>
<span>               <span class="st">"int.obsR"</span>,<span class="st">"Nbetas"</span>,</span>
<span>               <span class="st">"zeros"</span>,<span class="st">"zerosR"</span>,<span class="st">"rho"</span>, </span>
<span>               <span class="st">"status"</span>, <span class="st">"statusR"</span>,<span class="st">"K"</span><span class="op">)</span></span></code></pre></div>
<p>We specify the parameter of interest as follows.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Parameter of interest</span></span>
<span><span class="va">p.jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"beta"</span>,<span class="st">"alpha"</span><span class="op">)</span></span></code></pre></div>
<p>The standard normal distribution is used as an initial values for the
parameter of interest.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Initial values for each parameter</span></span>
<span><span class="va">i.jags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we call the <code>jags</code> function to conduct MCMC sampling
with <span class="math inline">\(3\)</span> chains as shown below. We
set number of iterations as <span class="math inline">\(niter=10,000\)</span> with a burn in of <span class="math inline">\(5000\)</span> and thinning of <span class="math inline">\(10\)</span>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>data <span class="op">=</span> <span class="va">d.jags</span>, model.file <span class="op">=</span> <span class="st">"powerprior.txt"</span>, inits <span class="op">=</span> <span class="va">i.jags</span>, n.chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               parameters<span class="op">=</span><span class="va">p.jags</span>,n.iter<span class="op">=</span><span class="va">niter</span>,n.burnin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,n.thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 1100</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 2</span></span>
<span><span class="co">#&gt;    Total graph size: 23016</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span></code></pre></div>
<p>The summary can be produced using the following command.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;                   mean         sd          2.5%           25%           50%</span></span>
<span><span class="co">#&gt; alpha     7.672650e-01 0.08330851  6.030597e-01  7.109502e-01  7.679483e-01</span></span>
<span><span class="co">#&gt; beta     -8.006893e-01 0.05042475 -8.986307e-01 -8.356531e-01 -8.005683e-01</span></span>
<span><span class="co">#&gt; deviance  2.200010e+08 1.86370178  2.200009e+08  2.200010e+08  2.200010e+08</span></span>
<span><span class="co">#&gt;                    75%         97.5%     Rhat n.eff</span></span>
<span><span class="co">#&gt; alpha     8.249207e-01  9.219494e-01 1.000049  1500</span></span>
<span><span class="co">#&gt; beta     -7.651435e-01 -7.026286e-01 1.000307  1500</span></span>
<span><span class="co">#&gt; deviance  2.200010e+08  2.200010e+08 1.000000     1</span></span></code></pre></div>
<p>The summary of the hazard ratio for treatment variable is shown
below.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,probs<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.3871170 0.4335912 0.4490737 0.4495901 0.4652671 0.5259439 0.4071268 0.4952818</span></span></code></pre></div>
<p>The histogram of the treatment hazard ratio can also be produced.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"treatmentHR"</span>,main<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-31-1.png" alt="plot of chunk unnamed-chunk-31"><p class="caption">
plot of chunk unnamed-chunk-31
</p>
</div>
<p>The traceplot can be generated as follows.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">traceplot</span><span class="op">(</span><span class="va">model1</span>,varname<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>,<span class="st">"beta"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-32-1.png" alt="plot of chunk unnamed-chunk-32"><p class="caption">
plot of chunk unnamed-chunk-32
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-32-2.png" alt="plot of chunk unnamed-chunk-32"><p class="caption">
plot of chunk unnamed-chunk-32
</p>
</div>
</div>
<div class="section level2">
<h2 id="commensurate-prior-with-piecewise-exponential-distribution-not-implemented-in-psborrow2-r-package">Commensurate prior with piecewise exponential distribution (not
implemented in <code>psborrow2</code> R package)<a class="anchor" aria-label="anchor" href="#commensurate-prior-with-piecewise-exponential-distribution-not-implemented-in-psborrow2-r-package"></a>
</h2>
<p>We will consider the Bayesian commensurate prior model.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>model{</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  <span class="co">#Trial Data</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>    <span class="co"># Pieces of the cumulative hazard function</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>int.obs[i]) {</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>      cond[i,k] <span class="ot">&lt;-</span> <span class="fu">step</span>(time[i] <span class="sc">-</span> a[k <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>      HH[i , k] <span class="ot">&lt;-</span> cond[i,k] <span class="sc">*</span> (a[k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alpha[k]) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">-</span> cond[i,k] ) <span class="sc">*</span> (time[i] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alpha[k])</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>    }</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>    <span class="co"># Cumulative hazard function</span></span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>    H[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(HH[i,<span class="dv">1</span> <span class="sc">:</span> int.obs[i]] )</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>  }</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>    <span class="co"># Linear predictor</span></span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>    elinpred[i] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">inprod</span>(beta[],X[i,]))</span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>    <span class="co"># Log-hazard function</span></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>    logHaz[i] <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">exp</span>(alpha[int.obs[i]]) <span class="sc">*</span> elinpred[i])</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>    <span class="co"># Log-survival function</span></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>    logSurv[i] <span class="ot">&lt;-</span> <span class="sc">-</span>H[i] <span class="sc">*</span> elinpred[i]</span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>    <span class="co"># Definition of the log-likelihood using zeros trick</span></span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>    phi[i] <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">-</span> wt[i]<span class="sc">*</span>status[i] <span class="sc">*</span> logHaz[i] <span class="sc">-</span> wt[i]<span class="sc">*</span>logSurv[i]</span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>    zeros[i] <span class="sc">~</span> <span class="fu">dpois</span>(phi[i])</span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>  }</span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a>  <span class="co">#Real World or External Control Data</span></span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a>   <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nR){</span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a>    <span class="co"># Pieces of the cumulative hazard function</span></span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>int.obsR[i]) {</span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a>      condE[i,k] <span class="ot">&lt;-</span> <span class="fu">step</span>(timeR[i] <span class="sc">-</span> a[k <span class="sc">+</span> <span class="dv">1</span>])</span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a>      HHE[i , k] <span class="ot">&lt;-</span> condE[i,k] <span class="sc">*</span> (a[k <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alphaR[k]) <span class="sc">+</span></span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">-</span> condE[i,k] ) <span class="sc">*</span> (timeR[i] <span class="sc">-</span> a[k]) <span class="sc">*</span> <span class="fu">exp</span>(alphaR[k])</span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a>    }</span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a>    <span class="co"># Cumulative hazard function</span></span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a>    HE[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(HHE[i,<span class="dv">1</span> <span class="sc">:</span> int.obsR[i]] )</span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a>  }</span>
<span id="cb37-36"><a href="#cb37-36" tabindex="-1"></a>  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nR) {</span>
<span id="cb37-37"><a href="#cb37-37" tabindex="-1"></a>    <span class="co"># Linear predictor</span></span>
<span id="cb37-38"><a href="#cb37-38" tabindex="-1"></a>    elinpredE[i] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">inprod</span>(beta0[],XR[i,]))</span>
<span id="cb37-39"><a href="#cb37-39" tabindex="-1"></a>    <span class="co"># Log-hazard function</span></span>
<span id="cb37-40"><a href="#cb37-40" tabindex="-1"></a>    logHazE[i] <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">exp</span>(alphaR[int.obsR[i]]) <span class="sc">*</span> elinpredE[i])</span>
<span id="cb37-41"><a href="#cb37-41" tabindex="-1"></a>    <span class="co"># Log-survival function</span></span>
<span id="cb37-42"><a href="#cb37-42" tabindex="-1"></a>    logSurvE[i] <span class="ot">&lt;-</span> <span class="sc">-</span>HE[i] <span class="sc">*</span> elinpredE[i]</span>
<span id="cb37-43"><a href="#cb37-43" tabindex="-1"></a>    <span class="co"># Definition of the log-likelihood using zeros trick</span></span>
<span id="cb37-44"><a href="#cb37-44" tabindex="-1"></a>    phiE[i] <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="sc">-</span> wtR[i]<span class="sc">*</span>statusR[i] <span class="sc">*</span> logHazE[i] <span class="sc">-</span> wtR[i] <span class="sc">*</span> logSurvE[i]</span>
<span id="cb37-45"><a href="#cb37-45" tabindex="-1"></a>    zerosR[i] <span class="sc">~</span> <span class="fu">dpois</span>(phiE[i])</span>
<span id="cb37-46"><a href="#cb37-46" tabindex="-1"></a>  }</span>
<span id="cb37-47"><a href="#cb37-47" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" tabindex="-1"></a>  <span class="co"># Commensurate prior on the covariate effect</span></span>
<span id="cb37-50"><a href="#cb37-50" tabindex="-1"></a>  <span class="cf">for</span>(l <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> Nbetas ){</span>
<span id="cb37-51"><a href="#cb37-51" tabindex="-1"></a>    beta0[l] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.0001</span>);</span>
<span id="cb37-52"><a href="#cb37-52" tabindex="-1"></a>    tau[l] <span class="sc">~</span> <span class="fu">dgamma</span>(<span class="fl">0.01</span>,<span class="fl">0.01</span>);</span>
<span id="cb37-53"><a href="#cb37-53" tabindex="-1"></a>    beta[l] <span class="sc">~</span> <span class="fu">dnorm</span>(beta0[l],tau[l]);</span>
<span id="cb37-54"><a href="#cb37-54" tabindex="-1"></a>  }</span>
<span id="cb37-55"><a href="#cb37-55" tabindex="-1"></a>  </span>
<span id="cb37-56"><a href="#cb37-56" tabindex="-1"></a>  <span class="co"># Normal prior on the piecewise exponential parameters for each interval</span></span>
<span id="cb37-57"><a href="#cb37-57" tabindex="-1"></a>  <span class="cf">for</span>( m <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> K) {</span>
<span id="cb37-58"><a href="#cb37-58" tabindex="-1"></a>  taualpha[m] <span class="sc">~</span> <span class="fu">dgamma</span>(<span class="fl">0.01</span>,<span class="fl">0.01</span>);</span>
<span id="cb37-59"><a href="#cb37-59" tabindex="-1"></a>  alpha[m] <span class="sc">~</span> <span class="fu">dnorm</span>(alphaR[m],taualpha[m]);</span>
<span id="cb37-60"><a href="#cb37-60" tabindex="-1"></a>  alphaR[m] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.0001</span>);</span>
<span id="cb37-61"><a href="#cb37-61" tabindex="-1"></a>  }</span>
<span id="cb37-62"><a href="#cb37-62" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" tabindex="-1"></a>} </span></code></pre></div>
<p>We now define all the variables as in input to JAGS.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_weights</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Trial Data</span></span>
<span><span class="va">trial.data</span> <span class="op">&lt;-</span> <span class="va">data_with_weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">indicator</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#External Control Data</span></span>
<span><span class="va">ext.control.data</span> <span class="op">&lt;-</span> <span class="va">data_with_weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">indicator</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#Input in JAGS code</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span> <span class="co">#Sample size in trial data</span></span>
<span><span class="va">nR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span> <span class="co">#Sample size in external control data</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">time</span> <span class="co">#Survival time in trial data</span></span>
<span><span class="va">timeR</span> <span class="op">&lt;-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span> <span class="co">#Survival time in external control data</span></span>
<span></span>
<span><span class="va">status</span> <span class="op">&lt;-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">event</span> <span class="co">#Event indicator in trial data</span></span>
<span><span class="va">statusR</span> <span class="op">&lt;-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">event</span> <span class="co">#Event indicator in external control data</span></span>
<span></span>
<span><span class="va">wt</span> <span class="op">&lt;-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">norm.weights</span> <span class="co">#Vector of weights in trial data</span></span>
<span><span class="va">wtR</span> <span class="op">&lt;-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">norm.weights</span> <span class="co">#Vector of weights in external control data</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="co">#Treatment indicator in trial data</span></span>
<span><span class="va">XR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="co">#Treatment indicator in trial data</span></span>
<span></span>
<span><span class="va">Nbetas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zeros</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">zerosR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nR</span><span class="op">)</span></span></code></pre></div>
<p>We also need to pre-specify the number of intervals. For simplicity,
we will consider <span class="math inline">\(K=1\)</span> interval.
However, this method also works when <span class="math inline">\(K&gt;1\)</span>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Time axis partition</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># number of intervals</span></span>
<span></span>
<span><span class="co">#Cut points (Using the event times in trial data)</span></span>
<span><span class="va">a</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">trial.data</span><span class="op">$</span><span class="va">event</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">K</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">K</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">$</span><span class="va">time</span>,<span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">0.0001</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Trial data</span></span>
<span><span class="co"># int.obs: vector that tells us at which interval each observation is</span></span>
<span><span class="va">int.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">trial.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">a</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">trial.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">int.obs</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">k</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">int.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">int.obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#External control data</span></span>
<span><span class="co"># int.obs: vector that tells us at which interval each observation is</span></span>
<span><span class="va">int.obsR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">a</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">k</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">ext.control.data</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">int.obsR</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">k</span><span class="op">]</span> <span class="op">*</span> <span class="va">k</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">int.obsR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">int.obsR</span><span class="op">)</span></span></code></pre></div>
<p>We now put all variables into a list as data inputs for JAGs. Note
that the letter <span class="math inline">\(R\)</span> in the following
corresponds to RWD. For example, <span class="math inline">\(XR\)</span>
is the covariate matrix in RWD.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### JAGS ####</span></span>
<span><span class="va">d.jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"nR"</span>, <span class="st">"time"</span>, <span class="st">"timeR"</span>,</span>
<span>               <span class="st">"a"</span>, <span class="st">"X"</span>, <span class="st">"XR"</span>,<span class="st">"int.obs"</span>,</span>
<span>               <span class="st">"int.obsR"</span>,<span class="st">"Nbetas"</span>,</span>
<span>               <span class="st">"zeros"</span>,<span class="st">"zerosR"</span>,<span class="st">"wt"</span>, <span class="st">"wtR"</span>,</span>
<span>               <span class="st">"status"</span>, <span class="st">"statusR"</span>,<span class="st">"K"</span><span class="op">)</span></span></code></pre></div>
<p>We specify the parameter of interest as follows. Note that
<code>alphaR</code> is the baseline hazard parameter for external
control.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Parameter of interest</span></span>
<span><span class="va">p.jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"beta"</span>,<span class="st">"alpha"</span>,<span class="st">"alphaR"</span>,<span class="st">"tau"</span><span class="op">)</span></span></code></pre></div>
<p>We generate initial values for <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\alpha\)</span> from standard normal
distributions, and <span class="math inline">\(\tau\)</span> from a
non-informative Gamma distribution.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Initial values for each parameter</span></span>
<span><span class="va">i.jags</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, beta0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>,alphaR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>,tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,shape <span class="op">=</span> <span class="fl">0.01</span>,scale<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we call the <code>jags</code> function to conduct MCMC sampling
with <span class="math inline">\(3\)</span> chains as shown below. We
set number of iterations as <span class="math inline">\(niter=10,000\)</span> with a burn in of <span class="math inline">\(5000\)</span> and thinning of <span class="math inline">\(10\)</span>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>data <span class="op">=</span> <span class="va">d.jags</span>, model.file <span class="op">=</span> <span class="st">"commensurateprior.txt"</span>, inits <span class="op">=</span> <span class="va">i.jags</span>, n.chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               parameters<span class="op">=</span><span class="va">p.jags</span>,n.iter<span class="op">=</span><span class="va">niter</span>,n.burnin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,n.thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 1100</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 5</span></span>
<span><span class="co">#&gt;    Total graph size: 24222</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span></code></pre></div>
<p>The summary can be produced using the following command.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;                   mean         sd          2.5%           25%           50%</span></span>
<span><span class="co">#&gt; alpha     7.012442e-01 0.08417559  5.422684e-01  6.433417e-01  6.995345e-01</span></span>
<span><span class="co">#&gt; alphaR    3.775493e+00 0.53271370  2.651884e+00  3.434386e+00  3.808735e+00</span></span>
<span><span class="co">#&gt; beta     -7.699118e-01 0.04937989 -8.653964e-01 -8.023713e-01 -7.688038e-01</span></span>
<span><span class="co">#&gt; deviance  2.200009e+08 3.59110530  2.200009e+08  2.200009e+08  2.200009e+08</span></span>
<span><span class="co">#&gt; tau       4.990748e-02 0.19141621  2.688540e-04  3.312027e-03  1.147687e-02</span></span>
<span><span class="co">#&gt;                    75%         97.5%     Rhat n.eff</span></span>
<span><span class="co">#&gt; alpha     7.626370e-01  8.639186e-01 1.002131   940</span></span>
<span><span class="co">#&gt; alphaR    4.142427e+00  4.781330e+00 1.002836   840</span></span>
<span><span class="co">#&gt; beta     -7.368342e-01 -6.755448e-01 1.000972  1500</span></span>
<span><span class="co">#&gt; deviance  2.200009e+08  2.200009e+08 1.000000     1</span></span>
<span><span class="co">#&gt; tau       3.066659e-02  2.970125e-01 1.001709  1200</span></span></code></pre></div>
<p>The summary of the hazard ratio for treatment variable is shown
below.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,probs<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.3924743 0.4482647 0.4635673 0.4636176 0.4786268 0.5455878 0.4208848 0.5088791</span></span></code></pre></div>
<p>The histogram of the treatment hazard ratio can also be produced.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"treatmentHR"</span>,main<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-42-1.png" alt="plot of chunk unnamed-chunk-42"><p class="caption">
plot of chunk unnamed-chunk-42
</p>
</div>
<p>The histogram of the commensurability parameter can also be
produced.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,xlab<span class="op">=</span><span class="st">"Commensurability Parameter"</span>,main<span class="op">=</span><span class="st">""</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-43-1.png" alt="plot of chunk unnamed-chunk-43"><p class="caption">
plot of chunk unnamed-chunk-43
</p>
</div>
<p>The traceplot can be created as follows.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">traceplot</span><span class="op">(</span><span class="va">model2</span>,varname<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>,<span class="st">"alphaR"</span>,<span class="st">"beta"</span>,<span class="st">"tau"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-44-1.png" alt="plot of chunk unnamed-chunk-44"><p class="caption">
plot of chunk unnamed-chunk-44
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-44-2.png" alt="plot of chunk unnamed-chunk-44"><p class="caption">
plot of chunk unnamed-chunk-44
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-44-3.png" alt="plot of chunk unnamed-chunk-44"><p class="caption">
plot of chunk unnamed-chunk-44
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-44-4.png" alt="plot of chunk unnamed-chunk-44"><p class="caption">
plot of chunk unnamed-chunk-44
</p>
</div>
</div>
<div class="section level2">
<h2 id="exponential-distribution-constant-hazard-and-no-borrowing-using-psborrow2-r-package">Exponential distribution (constant hazard) and no borrowing: Using
<code>psborrow2</code> R package<a class="anchor" aria-label="anchor" href="#exponential-distribution-constant-hazard-and-no-borrowing-using-psborrow2-r-package"></a>
</h2>
<p>In addition to specifying an exponential distribution using Bayesian
dynamic borrowing, naive no-borrowing and full-borrowing analysis can be
conducted using the exponential distribution following similar steps as
above. These ype of analysis could be used as a sensitivity or
exploratory analysis.</p>
<p>The <code>psborrow2</code> package will be used to conduct the
analysis. Following are the steps.</p>
<p>We use exponential distribution for the outcome model as follows.
Non-informative normal prior is used for the baseline parameter.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Outcome</span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outcome_surv_exponential.html">outcome_surv_exponential</a></span><span class="op">(</span></span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  cens_var <span class="op">=</span> <span class="st">"cnsr"</span>,</span>
<span>  baseline_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span></span>
<span><span class="co">#&gt; Outcome object with class OutcomeSurvExponential </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outcome variables:</span></span>
<span><span class="co">#&gt; time_var cens_var </span></span>
<span><span class="co">#&gt;   "time"   "cnsr" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Baseline prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Next, the borrowing method is implemented as shown below. We consider
no borrowing as shown below.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Borrowing</span></span>
<span><span class="va">borrowing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/borrowing_none.html">borrowing_none</a></span><span class="op">(</span></span>
<span>  ext_flag_col <span class="op">=</span> <span class="st">"ext"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">borrowing</span></span>
<span><span class="co">#&gt; Borrowing object using the  No borrowing  approach</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; External control flag: ext</span></span></code></pre></div>
<p>Similarly, details regarding the treatment variable is specified
below. Non-informative prior is used a prior for treatment effect.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Treatment</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/treatment_details.html">treatment_details</a></span><span class="op">(</span></span>
<span>  trt_flag_col <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  trt_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">treatment</span></span>
<span><span class="co">#&gt; Treatment object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment flag column: group </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment effect prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Now, all the pieces are brought together to create the analysis
object as shown below.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span><span class="co">#Application</span></span>
<span><span class="va">anls_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_analysis_obj.html">create_analysis_obj</a></span><span class="op">(</span></span>
<span>  data_matrix <span class="op">=</span> <span class="va">data_with_weights</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>  borrowing <span class="op">=</span> <span class="va">borrowing</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">treatment</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Inputs look good.</span></span>
<span><span class="co">#&gt; NOTE: excluding `ext` == `1`/`TRUE` for no borrowing.</span></span>
<span><span class="co">#&gt; Stan program compiled successfully!</span></span>
<span><span class="co">#&gt; Ready to go! Now call `mcmc_sample()`.</span></span></code></pre></div>
<p>Finally, we run the MCMC sample with <span class="math inline">\(3\)</span> chains.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.no.psborrow</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc_sample.html">mcmc_sample</a></span><span class="op">(</span><span class="va">anls_obj</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  iter_sampling <span class="op">=</span> <span class="va">niter</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 3 sequential chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 4.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 4.1 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 4.0 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 3 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 4.1 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 12.6 seconds.</span></span>
<span></span>
<span><span class="va">draws3</span> <span class="op">&lt;-</span> <span class="va">results.no.psborrow</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">draws3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename_draws_covariates.html">rename_draws_covariates</a></span><span class="op">(</span><span class="va">draws3</span>, <span class="va">anls_obj</span><span class="op">)</span></span></code></pre></div>
<p>The summary is shown below.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.no.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 10</span></span>
<span><span class="co">#&gt;   variable      mean    median     sd    mad       q5      q95  rhat ess_bulk</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__     -724.     -724.     0.995  0.718  -726.    -723.     1.00   10028.</span></span>
<span><span class="co">#&gt; 2 beta_trt   -0.0343   -0.0352 0.117  0.116    -0.224    0.159  1.00    7950.</span></span>
<span><span class="co">#&gt; 3 alpha      -0.948    -0.947  0.0989 0.0989   -1.11    -0.787  1.00    7991.</span></span>
<span><span class="co">#&gt; 4 HR_trt      0.973     0.965  0.114  0.112     0.799    1.17   1.00    7950.</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: ess_tail &lt;dbl&gt;</span></span></code></pre></div>
<p>The histogram of the posterior samples for hazard ratio and
commensurability parameter as shown below.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="va">draws3</span>, <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-51-1.png" alt="plot of chunk unnamed-chunk-51"><p class="caption">
plot of chunk unnamed-chunk-51
</p>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span></code></pre></div>
<p>The <span class="math inline">\(95\%\)</span> credible interval can
be calculated as follows.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws3</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;   variable                   `2.5%`  `97.5%`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__                     -727.    -723.   </span></span>
<span><span class="co">#&gt; 2 treatment log HR           -0.264    0.195</span></span>
<span><span class="co">#&gt; 3 baseline log hazard rate   -1.14    -0.757</span></span>
<span><span class="co">#&gt; 4 treatment HR                0.768    1.22</span></span></code></pre></div>
<p>We can see other plots that help us understand and diagnose problems
with the MCMC sampler, such as trace plot.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span></span>
<span>  <span class="va">draws3</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, <span class="co"># Using a subset of draws only</span></span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span><span class="op">)</span>,</span>
<span>  n_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-53-1.png" alt="plot of chunk unnamed-chunk-53"><p class="caption">
plot of chunk unnamed-chunk-53
</p>
</div>
</div>
<div class="section level2">
<h2 id="exponential-distribution-constant-hazard-and-full-borrowing-using-psborrow2-r-package">Exponential distribution (constant hazard) and full borrowing: Using
<code>psborrow2</code> R package<a class="anchor" aria-label="anchor" href="#exponential-distribution-constant-hazard-and-full-borrowing-using-psborrow2-r-package"></a>
</h2>
<p>The <code>psborrow2</code> package will be used to conduct the
analysis. Following are the steps.</p>
<p>We use exponential distribution for the outcome model as follows.
Non-informative normal prior is used for the baseline parameter.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Outcome</span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outcome_surv_exponential.html">outcome_surv_exponential</a></span><span class="op">(</span></span>
<span>  time_var <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  cens_var <span class="op">=</span> <span class="st">"cnsr"</span>,</span>
<span>  baseline_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span></span>
<span><span class="co">#&gt; Outcome object with class OutcomeSurvExponential </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outcome variables:</span></span>
<span><span class="co">#&gt; time_var cens_var </span></span>
<span><span class="co">#&gt;   "time"   "cnsr" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Baseline prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Next, the borrowing method is implemented as shown below. We consider
full borrowing as shown below.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Borrowing</span></span>
<span><span class="va">borrowing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/borrowing_full.html">borrowing_full</a></span><span class="op">(</span>ext_flag_col <span class="op">=</span> <span class="st">"ext"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">borrowing</span></span>
<span><span class="co">#&gt; Borrowing object using the  Full borrowing  approach</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; External control flag: ext</span></span></code></pre></div>
<p>Similarly, details regarding the treatment variable is specified
below. Non-informative prior is used a prior for treatment effect.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Treatment</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/treatment_details.html">treatment_details</a></span><span class="op">(</span></span>
<span>  trt_flag_col <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  trt_prior <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">treatment</span></span>
<span><span class="co">#&gt; Treatment object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment flag column: group </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment effect prior:</span></span>
<span><span class="co">#&gt; Normal Distribution</span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;  Stan  R    Value</span></span>
<span><span class="co">#&gt;  mu    mean    0 </span></span>
<span><span class="co">#&gt;  sigma sd   1000</span></span></code></pre></div>
<p>Now, all the pieces are brought together to create the analysis
object as shown below.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Application</span></span>
<span><span class="va">anls_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_analysis_obj.html">create_analysis_obj</a></span><span class="op">(</span></span>
<span>  data_matrix <span class="op">=</span> <span class="va">data_with_weights</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>  borrowing <span class="op">=</span> <span class="va">borrowing</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">treatment</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Inputs look good.</span></span>
<span><span class="co">#&gt; NOTE: dropping column `ext` for full borrowing.</span></span>
<span><span class="co">#&gt; Stan program compiled successfully!</span></span>
<span><span class="co">#&gt; Ready to go! Now call `mcmc_sample()`.</span></span></code></pre></div>
<p>Finally, we run the MCMC sample with <span class="math inline">\(3\)</span> chains.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.full.psborrow</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc_sample.html">mcmc_sample</a></span><span class="op">(</span><span class="va">anls_obj</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  iter_sampling <span class="op">=</span> <span class="va">niter</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 3 sequential chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 finished in 5.7 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 5.6 seconds.</span></span>
<span><span class="co">#&gt; Chain 3 finished in 5.6 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All 3 chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 5.7 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 17.4 seconds.</span></span>
<span></span>
<span><span class="va">draws4</span> <span class="op">&lt;-</span> <span class="va">results.full.psborrow</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">draws4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rename_draws_covariates.html">rename_draws_covariates</a></span><span class="op">(</span><span class="va">draws4</span>, <span class="va">anls_obj</span><span class="op">)</span></span></code></pre></div>
<p>The summary is shown below.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.full.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 10</span></span>
<span><span class="co">#&gt;   variable     mean   median     sd    mad       q5      q95  rhat ess_bulk</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__     -815.    -814.    1.01   0.710  -817.    -814.     1.00   14094.</span></span>
<span><span class="co">#&gt; 2 beta_trt   -1.32    -1.32  0.0781 0.0775   -1.45    -1.19   1.00   11317.</span></span>
<span><span class="co">#&gt; 3 alpha       0.339    0.339 0.0476 0.0480    0.260    0.416  1.00   11709.</span></span>
<span><span class="co">#&gt; 4 HR_trt      0.268    0.267 0.0209 0.0207    0.235    0.303  1.00   11317.</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: ess_tail &lt;dbl&gt;</span></span></code></pre></div>
<p>The histogram of the posterior samples for hazard ratio and
commensurability parameter as shown below.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="va">draws4</span>, <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-60-1.png" alt="plot of chunk unnamed-chunk-60"><p class="caption">
plot of chunk unnamed-chunk-60
</p>
</div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span></code></pre></div>
<p>The <span class="math inline">\(95\%\)</span> credible interval can
be calculated as follows.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws4</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;   variable                   `2.5%`  `97.5%`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 lp__                     -817.    -814.   </span></span>
<span><span class="co">#&gt; 2 treatment log HR           -1.47    -1.17 </span></span>
<span><span class="co">#&gt; 3 baseline log hazard rate    0.245    0.430</span></span>
<span><span class="co">#&gt; 4 treatment HR                0.229    0.311</span></span></code></pre></div>
<p>We can see other plots that help us understand and diagnose problems
with the MCMC sampler, such as trace plot.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-blue-pink"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span></span>
<span>  <span class="va">draws4</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, <span class="co"># Using a subset of draws only</span></span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"treatment HR"</span><span class="op">)</span>,</span>
<span>  n_warmup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">niter</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure-match_weight_02_application-unnamed-chunk-62-1.png" alt="plot of chunk unnamed-chunk-62"><p class="caption">
plot of chunk unnamed-chunk-62
</p>
</div>
</div>
<div class="section level2">
<h2 id="cox-proportional-hazards-model-using-frequentist-approach-no-borrowing">Cox proportional hazards model using frequentist approach (No
borrowing)<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards-model-using-frequentist-approach-no-borrowing"></a>
</h2>
<p>Now, we also demonstrate how researchers would fit a frequentist Cox
model. For the first model, we will not borrow any information from
external controls and use the trial data only.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_weights</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span><span class="va">group</span>, data<span class="op">=</span><span class="va">data_with_weights</span><span class="op">[</span><span class="va">data_with_weights</span><span class="op">$</span><span class="va">ext</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(time, event) ~ group, data = data_with_weights[data_with_weights$ext == </span></span>
<span><span class="co">#&gt;     0, ])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 600, number of events= 367 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           coef exp(coef) se(coef)      z Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; group -0.02944   0.97099  0.11673 -0.252    0.801</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; group     0.971       1.03    0.7724     1.221</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.512  (se = 0.014 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 0.06  on 1 df,   p=0.8</span></span>
<span><span class="co">#&gt; Wald test            = 0.06  on 1 df,   p=0.8</span></span>
<span><span class="co">#&gt; Score (logrank) test = 0.06  on 1 df,   p=0.8</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cox-proportional-hazards-model-using-frequentist-approach-full-borrowing-from-external-control">Cox proportional hazards model using frequentist approach (Full
borrowing from external control)<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards-model-using-frequentist-approach-full-borrowing-from-external-control"></a>
</h2>
<p>A frequentist Cox model can also be fitted using all of the external
control data via full borrowing.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span><span class="va">group</span>, data<span class="op">=</span><span class="va">data_with_weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">f2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(time, event) ~ group, data = data_with_weights)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   n= 1100, number of events= 703 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           coef exp(coef) se(coef)      z Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; group -0.98910   0.37191  0.08018 -12.34   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">#&gt; group    0.3719      2.689    0.3178    0.4352</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Concordance= 0.662  (se = 0.007 )</span></span>
<span><span class="co">#&gt; Likelihood ratio test= 158.1  on 1 df,   p=&lt;2e-16</span></span>
<span><span class="co">#&gt; Wald test            = 152.2  on 1 df,   p=&lt;2e-16</span></span>
<span><span class="co">#&gt; Score (logrank) test = 162.7  on 1 df,   p=&lt;2e-16</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summarizing-all-the-results-together">Summarizing all the results together<a class="anchor" aria-label="anchor" href="#summarizing-all-the-results-together"></a>
</h2>
<p>Now, we concatenate the results from all of the Bayesian and
frequentist analysis approaches together.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hr1</span><span class="op">=</span><span class="va">results.exp.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr1conf</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws1</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr1.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">hr1</span><span class="op">$</span><span class="va">mean</span>,<span class="va">hr1conf</span><span class="op">$</span><span class="va">`2.5%`</span>,<span class="va">hr1conf</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr2</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,probs<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hr2.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">hr2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr3</span><span class="op">=</span><span class="va">results.weib.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr3conf</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws2</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr3.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">hr3</span><span class="op">$</span><span class="va">mean</span>,<span class="va">hr3conf</span><span class="op">$</span><span class="va">`2.5%`</span>,<span class="va">hr3conf</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr4</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,probs<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hr4.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">hr4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr5</span><span class="op">=</span><span class="va">results.no.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr5conf</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws3</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr5.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">hr5</span><span class="op">$</span><span class="va">mean</span>,<span class="va">hr5conf</span><span class="op">$</span><span class="va">`2.5%`</span>,<span class="va">hr5conf</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr6</span><span class="op">=</span><span class="va">results.full.psborrow</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr6conf</span> <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="va">draws4</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>,<span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">hr6.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="va">hr6</span><span class="op">$</span><span class="va">mean</span>,<span class="va">hr6conf</span><span class="op">$</span><span class="va">`2.5%`</span>,<span class="va">hr6conf</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr7.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hr8.conf</span><span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">f2</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">f2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">hr1.conf</span>,<span class="va">hr2.conf</span>,<span class="va">hr3.conf</span>,<span class="va">hr4.conf</span>,<span class="va">hr5.conf</span>,<span class="va">hr6.conf</span>,<span class="va">hr7.conf</span>,<span class="va">hr8.conf</span><span class="op">)</span>,<span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Method<span class="op">=</span><span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"Exponential distribution (constant hazard) and gamma prior"</span>,</span>
<span>                          <span class="st">"Piecewise exponential distribution (proportional hazard) and power prior"</span>,</span>
<span>                          <span class="st">"Weibull distribution (proportional hazard) and gamma prior"</span>,</span>
<span>                          <span class="st">"Piecewise exponential distribution (proportional hazard) and commensurate prior"</span>,</span>
<span>                          <span class="st">"Exponential distribution (constant hazard): No borrowing"</span>,</span>
<span>                          <span class="st">"Exponential distribution (constant hazard): Full borrowing"</span>,</span>
<span>                          <span class="st">"Cox model (Frequentist approach): No borrowing"</span>,</span>
<span>                          <span class="st">"Cox model (Frequentist approach): Full borrowing"</span><span class="op">)</span>,<span class="va">out</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/c.html">c</a></span><span class="op">(</span><span class="st">"Hazard Ratio"</span>,<span class="st">"Lower 95% CI"</span>,<span class="st">"Upper 95% CI"</span><span class="op">)</span></span></code></pre></div>
The hazard ratio estimates and <span class="math inline">\(95\%\)</span>
credible intervals for all the methods are shown below.
<table class="table">
<thead><tr>
<th style="text-align:left;">
Method
</th>
<th style="text-align:right;">
Hazard Ratio
</th>
<th style="text-align:right;">
Lower 95% CI
</th>
<th style="text-align:right;">
Upper 95% CI
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Exponential distribution (constant hazard) and gamma prior
</td>
<td style="text-align:right;">
0.9703
</td>
<td style="text-align:right;">
0.7665
</td>
<td style="text-align:right;">
1.2148
</td>
</tr>
<tr>
<td style="text-align:left;">
Piecewise exponential distribution (proportional hazard) and power prior
</td>
<td style="text-align:right;">
0.4496
</td>
<td style="text-align:right;">
0.4071
</td>
<td style="text-align:right;">
0.4953
</td>
</tr>
<tr>
<td style="text-align:left;">
Weibull distribution (proportional hazard) and gamma prior
</td>
<td style="text-align:right;">
0.9787
</td>
<td style="text-align:right;">
0.7756
</td>
<td style="text-align:right;">
1.2249
</td>
</tr>
<tr>
<td style="text-align:left;">
Piecewise exponential distribution (proportional hazard) and
commensurate prior
</td>
<td style="text-align:right;">
0.4636
</td>
<td style="text-align:right;">
0.4209
</td>
<td style="text-align:right;">
0.5089
</td>
</tr>
<tr>
<td style="text-align:left;">
Exponential distribution (constant hazard): No borrowing
</td>
<td style="text-align:right;">
0.9729
</td>
<td style="text-align:right;">
0.7682
</td>
<td style="text-align:right;">
1.2156
</td>
</tr>
<tr>
<td style="text-align:left;">
Exponential distribution (constant hazard): Full borrowing
</td>
<td style="text-align:right;">
0.2678
</td>
<td style="text-align:right;">
0.2290
</td>
<td style="text-align:right;">
0.3110
</td>
</tr>
<tr>
<td style="text-align:left;">
Cox model (Frequentist approach): No borrowing
</td>
<td style="text-align:right;">
0.9710
</td>
<td style="text-align:right;">
0.7724
</td>
<td style="text-align:right;">
1.2206
</td>
</tr>
<tr>
<td style="text-align:left;">
Cox model (Frequentist approach): Full borrowing
</td>
<td style="text-align:right;">
0.3719
</td>
<td style="text-align:right;">
0.3178
</td>
<td style="text-align:right;">
0.4352
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup></sup> CI: Credible Interval for Bayesian methods and Confidence
interval for Frequentist method
</td>
</tr></tfoot>
</table>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-alvares2021bayesian" class="csl-entry">
Alvares, Danilo, Elena Lázaro, Virgilio Gómez-Rubio, and Carmen Armero.
2021. <span>“Bayesian Survival Analysis with BUGS.”</span>
<em>Statistics in Medicine</em> 40 (12): 2975–3020.
</div>
<div id="ref-cox1972regression" class="csl-entry">
Cox, David R. 1972. <span>“Regression Models and Life-Tables.”</span>
<em>Journal of the Royal Statistical Society: Series B
(Methodological)</em> 34 (2): 187–202.
</div>
<div id="ref-ibrahim2015power" class="csl-entry">
Ibrahim, Joseph G, Ming-Hui Chen, Yeongjin Gwon, and Fang Chen. 2015.
<span>“The Power Prior: Theory and Applications.”</span> <em>Statistics
in Medicine</em> 34 (28): 3724–49.
</div>
<div id="ref-psborrow2" class="csl-entry">
Isaac Gravestock, Matthew H Secrest. 2024. <span>“Psborrow2: An r
Package for Bayesian Dynamic Borrowing Simulation Study and
Analysis.”</span> <a href="https://github.com/Genentech/psborrow2" class="external-link">https://github.com/Genentech/psborrow2</a>.
</div>
<div id="ref-khanal2022semiparametric" class="csl-entry">
Khanal, Manoj. 2022. <span>“Semiparametric Regression Models for
Clustered Right-Censored Data Under Clinical Trials and Observational
Studies.”</span> PhD thesis, The Medical College of Wisconsin.
</div>
<div id="ref-lazaro2021bayesian" class="csl-entry">
Lázaro, Elena, Carmen Armero, and Danilo Alvares. 2021. <span>“Bayesian
Regularization for Flexible Baseline Hazard Functions in Cox Survival
Models.”</span> <em>Biometrical Journal</em> 63 (1): 7–26.
</div>
<div id="ref-murray2014semiparametric" class="csl-entry">
Murray, Thomas A, Brian P Hobbs, Theodore C Lystig, and Bradley P
Carlin. 2014. <span>“Semiparametric Bayesian Commensurate Survival Model
for Post-Market Medical Device Surveillance with Non-Exchangeable
Historical Data.”</span> <em>Biometrics</em> 70 (1): 185–91.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Secrest, Isaac Gravestock, Genentech, Inc..</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
